<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pranshul' App</title>
    <link rel="stylesheet" href="style.css" type="text/css">
</head>

<body>
    <div class="app">
        <div class="screen join-screen active">
            <div class="form">
                <h2>Join My Chatting App</h2>
                <div class="form-input">
                    <label>Username</label>
                    <input type="text" id="username">
                </div>
                <div class="form-input">
                    <button id="join-user">Join</button>
                </div>
                
            </div>
        </div>
        
        <div class="screen chat-screen">
            <div class="header">
                <div class="logo">
                    ChatRoom
                </div>
                <button id="exit-chat">Exit</button>
            </div>
            <div class="messages">
                <div class="message my-message">
                    <!-- <div>
                        <div class="name">You</div>
                        <div class="text">Hi</div>
                    </div> -->
                </div>
            </div>
            <div class="update">
                
            </div>
            <div class="messages">
                <div class="message other-message">
                    <!-- <div>
                        <div class="name">You</div>
                        <div class="text">Hi</div>
                    </div> -->
                </div>
            </div>

            <div class="typebox">
                <input type="text" id="message-input">
          <button id="send-message">Send</button>

        </div>
        
    </div>
    
    
    
    
</div>




</body>
<script type="text/javascript" src="socket.io/socket.io.js">

const express = require("express");
const path = require("path");

const app = express();
const server = require("http").createServer(app);

const io = require("socket.io")(server);

app.use(express.static(path.join(__dirname+"/public")));

io.on("connection", socket=>{
    socket.on("newuser", username=>{
        socket.broadcast.emit("update", username + "joined the conversation")
    })
    socket.on("exituser", username=>{
        socket.broadcast.emit("update", username + "left the conversation")
    })
    socket.on("chat", message=>{
        socket.broadcast.emit("chat", message)
    })
})

server.listen(5000);




</script>
<script type="text/javascript" src="code.js">
   

(function(){
    
    const app = document.querySelector(".app");
    const socket = io();
    var audio = new Audio("ting.mp3");

    let uname;

    app.querySelector("#join-user").addEventListener("click", function(){
     let username = app.querySelector("#username").value;
     
     if(username.length == 0){
        return;
     }
     socket.emit("newuser", username);
     uname = username;
     app.querySelector(".join-screen").classList.remove("active");
     app.querySelector(".chat-screen").classList.add("active");

    })
    app.querySelector("#send-message").addEventListener("click", function(){
      let message = app.querySelector("#message-input").value;

      if(message.length == 0){
        return;
      }
      rendermessage("my",{
       username: uname,
       text:message
     } )
      socket.emit("chat", {
        username : uname,
        text: message
      });
      app.querySelector("#message-input").value="";

    })

    app.querySelector("#exit-chat").addEventListener("click", function(){
     socket.emit("exituser", uname);
     window.location.href = window.location.href;

    })

    socket.on("update", function(update){
        rendermessage("update", message);
    })
    socket.on("chat", function(message){
        rendermessage("other", message);
    })

    function rendermessage(type, message){
          let messageContainer = app.querySelector(".messages");
           if(type == "my"){
            let el = document.createElement("div");
            
            el.setAttribute("class", "message my-message");
            el.innerHTML=`
             <div>
               <div class="name">You</div>
               <div class="text">${message.text}</div>

             </div>
            
            `;
            messageContainer.appendChild(el);
            audio.play();
           }
           else if(type == "other"){
            let el = document.createElement("div");
            
            el.setAttribute("class", "message other-message");
            el.innerHTML=`
             <div>
               <div class="name">${message.username}</div>
               <div class="text">${message.text}</div>

             </div>
            
            `;
            messageContainer.appendChild(el);
            audio.play();
           }
           else if(type == "update"){
            let el = document.createElement("div");
            
            el.setAttribute("class", "update");
            el.innerHtml= message;
             
           
            messageContainer.appendChild(el);

           }
           messageContainer.scrollTop = messageContainer.scrollHeight - messageContainer.clientHeight;
    }







})();

  


</script>

</html>